<script>
  const students = [
    {
      name: 'Thomas Graham',
      id: '56254',
      status: 'active',
      grade: '—',
      dob: '—',
      notes: 'no additional flags'
    },
    {
      name: 'Lucas Johnson',
      id: '54698',
      status: 'active',
      grade: '—',
      dob: '—',
      notes: 'no additional flags'
    }
  ];

  const q = document.getElementById('query');
  const results = document.getElementById('results');
  const dbList = document.getElementById('dbList');
  const overlay = document.getElementById('overlay');
  const drawer = document.getElementById('drawer');
  const photoEl = document.getElementById('d_photo');

  function emailFor(name) {
    const p = name.toLowerCase().split(' ');
    return `${p[p.length-1]}.${p[0]}@gloucestertownshipschools.org`;
  }

  function openDrawer(s) {
    document.getElementById('d_name').textContent = s.name;
    document.getElementById('d_id').textContent = s.id;
    document.getElementById('d_status').textContent = s.status;
    document.getElementById('d_grade').textContent = s.grade;
    document.getElementById('d_dob').textContent = s.dob;
    document.getElementById('d_notes').textContent = s.notes;
    document.getElementById('d_email').textContent = emailFor(s.name);
    document.getElementById('d_pass').textContent = `Password: GTps${s.id}`;

    photoEl.src = `${s.id}.jpg`;
    photoEl.onerror = () => { photoEl.src = ''; };

    overlay.classList.add('active');
    drawer.classList.add('active');
  }

  function closeDrawer() {
    overlay.classList.remove('active');
    drawer.classList.remove('active');
  }

  overlay.onclick = closeDrawer;
  document.getElementById('close').onclick = closeDrawer;

  function makeRow(s) {
    const row = document.createElement('div');
    row.className = 'row';
    row.innerHTML = `<span>${s.name}</span><span class="tag">${s.id}</span>`;
    row.onclick = () => openDrawer(s);
    return row;
  }

  function renderSearch() {
    const v = (q.value || '').toLowerCase().trim();
    results.innerHTML = '';
    if (!v) return;
    const hits = students.filter(s =>
      s.name.toLowerCase().includes(v) || s.id.includes(v)
    );
    if (!hits.length) {
      results.innerHTML =
        '<div class="row"><span>no match</span><span class="tag">0</span></div>';
      return;
    }
    hits.forEach(s => results.appendChild(makeRow(s)));
  }

  function renderDB() {
    dbList.innerHTML = '';
    students.forEach(s => dbList.appendChild(makeRow(s)));
  }

  q.addEventListener('input', renderSearch);
  renderDB();

  document.querySelectorAll('.btn').forEach(b => {
    b.onclick = () => {
      document.querySelectorAll('.btn').forEach(x => x.classList.remove('active'));
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      b.classList.add('active');
      document.getElementById(b.dataset.tab).classList.add('active');
    };
  });
</script>
